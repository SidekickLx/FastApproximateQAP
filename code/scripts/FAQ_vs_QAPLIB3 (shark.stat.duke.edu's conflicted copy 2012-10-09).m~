clear

dataDir = '../../data/graphm/09.20.2012/';
figDir = '../../figs/';
fileName = 'allPathCompare';
figName=[figDir, fileName];
load([dataDir, 'A.mat'])
savestuff=1;



%%

names=fieldnames(A(1));
len=length(A);

for i=1:len
    
    for j=4:length(names)
        times.(names{j})(i)=A(i).(names{j}).t;
        obj.(names{j})(i)=A(i).(names{j}).obj;
        laps.(names{j})(i)=A(i).(names{j}).laps;
    end
    
    obj_p(i)=A(i).obj_p;
    Nvertices(i)=length(A(i).FAQ.p);
end

minTime=inf;
maxTime=-inf;

minObj=inf;
maxObj=-inf;

for j=4:length(names)
    rel.times.(names{j})=times.FAQ./times.(names{j});
    rel.obj.(names{j})=obj.FAQ./obj.(names{j});
    
    minTime=min(minTime,min(rel.times.(names{j})));
    maxTime=max(maxTime,max(rel.times.(names{j})));
    
    minObj=min(minObj,min(rel.obj.(names{j})));
    maxObj=max(maxObj,max(rel.obj.(names{j})));
    
end



%% plot all comparisons comparison


clc

algNames=fieldnames(times);
ncols=3;
nrows=1;

YTickObj=[-1:.2:0.2];
XTick=log10([10 50 200]);
YTickTime=[1e-3 1e-1 10 600];
gray=0.75*[1 1 1];
ms=12;

numAlgs=length(algNames);

for i=3%2:numAlgs
    
    figure(i), clf
    
    X=log10(Nvertices);
    y=log10(rel.obj.(algNames{i}));
    subplot(nrows,ncols,1), hold on
    plot(X,y,'k.','markersize',ms)
    plot([min(X) max(X)],[0 0],'color',gray)
    plot(mean(X),nanmean(y),'.','color',gray','markersize',2*ms)
    ylabel('log relative objective value')
    xlabel('number of vertices')
    set(gca,'Xscale','log')
    set(gca,'YTick',YTickObj,'YTickLabel',YTickObj)
    set(gca,'XTick',XTick,'XTickLabel',10.^XTick)
    axis([min(X) max(X) min(y) max(y)])
    fracBetter=1-sum(y>0)/length(y);
    title(sprintf('%% better = %0.2f', fracBetter))
    
    
    subplot(nrows,ncols,2), hold on
    yTime=log10(rel.times.(algNames{i}));
    plot(X,yTime,'k.','markersize',ms)
    plot([min(X) max(X)],[0 0],'color',gray)
    % plot(mean(X),nanmean(yTime),'.','color',gray','markersize',2*ms)
    b=robustfit(X,yTime);
    plot(X,b(1)+b(2)*X,'-','color',gray,'linewidth',2)
    % ylabel('log(t_F/t_P)')
    ylabel('log relative time')
    xlabel('number of vertices')
    set(gca,'XTick',XTick,'XTickLabel',10.^XTick)
    axis([min(X) max(X) min(yTime) max(yTime)])
    fracBetter=1-sum(yTime>0)/length(y);
    title(sprintf('%% better = %0.2f', fracBetter))
    
    subplot(nrows,ncols,3), hold on
    plot(y,yTime,'k.','markersize',ms)
    plot([0 0],[-4 3],'color',gray)
    plot([-2 2],[0 0],'color',gray)
    plot(nanmean(y),nanmean(yTime),'.','color',gray','markersize',2*ms)
    ylabel('log relative time')
    xlabel('log relative objective function')
    axis([min(y) max(y) min(yTime) max(yTime)])
    fracBetter=1-(sum(yTime>0)+sum(y>0))/length(y);
    title(sprintf('%% better = %0.2f', fracBetter))
    
    
end

%%

if savestuff
    wh=[3 2]*1.75;   %width and height
    set(gcf,'PaperSize',wh,'PaperPosition',[0 0 wh],'Color','w');
    print('-dpdf',figName)
    print('-dpng',figName)
    saveas(gcf,figName)
end


%% make table

for i = 1:length(A)
    opt(i)=A(i).obj_p;
end
opt(opt<0)=nan;

%%

clc
[foo bar]=min([obj.(algNames{2}); obj.(algNames{3}); obj.(algNames{4}); obj.(algNames{5}); obj.(algNames{6}); obj.(algNames{7})]);
for i=1:43 %length(A)
    
    switch bar(i)
        case 1      
            fprintf('%1.0f & %s & %1.3g & \\textbf{%1.3g} & %1.3g & %1.3g & %1.3g & %1.3g \\\\ \n', ...
                i, A(i).name, opt(i), ...
                A(i).FAQ.obj, A(i).PATH.obj, A(i).QCV.obj, A(i).RANK.obj, A(i).U.obj)
        case 3      
            fprintf('%1.0f & %s & %1.3g & %1.3g & \\textbf{%1.3g} & %1.3g & %1.3g & %1.3g \\\\ \n', ...
                i, A(i).name, opt(i), ...
                A(i).FAQ.obj, A(i).PATH.obj, A(i).QCV.obj, A(i).RANK.obj, A(i).U.obj)
        case 4      
            fprintf('%1.0f & %s & %1.3g & %1.3g & %1.3g & \\textbf{%1.3g} & %1.3g & %1.3g \\\\ \n', ...
                i, A(i).name, opt(i), ...
                A(i).FAQ.obj, A(i).PATH.obj, A(i).QCV.obj, A(i).RANK.obj, A(i).U.obj)
        case 6      
            fprintf('%1.0f & %s & %1.3g & %1.3g & %1.3g & %1.3g & \\textbf{%1.3g} & %1.3g \\\\ \n', ...
                i, A(i).name, opt(i), ...
                A(i).FAQ.obj, A(i).PATH.obj, A(i).QCV.obj, A(i).RANK.obj, A(i).U.obj)
        case 7      
            fprintf('%1.0f & %s & %1.3g & %1.3g & %1.3g & %1.3g & %1.3g & \\textbf{%1.3g} \\\\ \n', ...
                i, A(i).name, opt(i), ...
                A(i).FAQ.obj, A(i).PATH.obj, A(i).QCV.obj, A(i).RANK.obj, A(i).U.obj)
    end
end



